
## React的架构
react是函数式+不可变数据的一个框架，它的设计模式是modal to view，单向数据流。在具体的数据结构上，是以fiber为基本节点，在其中承载了组件的一些数据和行为，然后由一个又一个fiber组成链表，每个fiber又保存着指向兄弟节点和父子节点的指针，拥有着层次结构，最终就形成了一个fiber tree。

react的数据驱动视图的逻辑，都是基于这个fiber tree去实现的。它大致分为两个阶段，一个协调阶段，一个是提交阶段。在协调阶段，会遍历fiber tree，执行更新调度，对render进行diff逻辑，最终收集副作用，去进行提交。

在提交阶段，会执行一些生命周期方法，然后挂载节点。

在整个协调中，会采用时间分片的方法，在浏览器一帧中的空余时间去执行处理，并且随时可以中断恢复，不阻塞渲染进程，最后再进行提交，这样就能极大的优化了渲染的性能。

## React 的编程思想
他的编程思想我概括一下：
- 简单
- 灵活
- 粒度更细，组件化更彻底

在react中，modal层和view层是可以解耦的。对于逻辑组件，只需要描述数据模型本身，决定入参和输出是什么，而没有多余的外部依赖和副作用，形成一个干净和透明的纯函数。

对于视图组件，也只有props这一个外部输入，没有内部状态，形成一个受控模式。
形成有状态无渲染，有渲染无状态。整个数据流清晰透明，这个就是react比较推荐的一种编程哲学。

然后再说到react hooks

## React 为什么是 Immutale


## React hooks 的优点

### 粒度更细

- 从class的一个总的state状态，拆分为单独的一个个更细粒度的state，并使得“状态”与“变更状态的逻辑”两两配对，这样就能更加灵活的去控制。

### 从命令式变成声明式

对于某个功能，我们通常需要在挂载后，状态变更后，组件卸载前进行调用。如果用class的声明周期，那就分别需要在componentDidMount,componentDidUpdate,ComponentWillUnmount，这三处地方去写逻辑。相比起来，使用hook的话只需要在useEffect这一个地方做处理。会在效率上和可维护性上远高于class

### 数据和视图解耦

react class，其实只是UI框架，状态和视图耦合在一块，一切都是为视图而服务，没有独立的一层model。

很多本该由 service层，model层去做的事情，都放在了view层去做。导致view层在处理前端交互的同时，还要去处理业务逻辑，与接口通信。代码耦合性严重，不利于复用。

## Hooks 与 Class 的区别
hooks把对象这个概念瓦解了。

在class中，有构造函数一些数据初始化，有method方法和生命周期方法作为一个行为，数据和行为之间也能进行关联。

但实际上，数据——行为——关联是三个维度，他们可以不被捆绑在一个对象中。

在hooks里，数据可以单独声明（useState），行为也可以单独声明（useEffect），数据和行为可以进行可选的关联（custom-hooks）。并且数据可以单独组合，行为可以单独组合，组合的数据和组合的行为可以进行再度组合。组合的维度得到了横向和纵向的自由度扩展。

这个就是hooks与class的区别。

## function 与 class 的区别
vue和react都抛弃了基于class组织组件的模式，是为了解决逻辑复用带来的命名冲突问题以及依赖注入问题。

函数式提供底层抽象能力，面向对象提供业务组织能力。

函数式负责提高复用能力，简化代码实现，提升代码的信息密度。

面向对象负责描述组件/模块之间的关系和业务逻辑，提高代码可读性，致力于显式地充分暴露业务客观存在的复杂度。

## UI 与逻辑分离
因为 UI 的抽象层次比较低

首先，抽象是有高低的，我们设定抽象的“层次高”是指一个事物更加地靠近抽象的一端，具备更少的具体能力，而“层次低”则表示事物更为具体，更靠近实现。那么，**UI显然是抽象层次最低的那一部分。**

UI是**强依赖于一个运行环境**的，且UI的**最小粒度组成的定义是非常具体**的，我们通常称之为“组件”或者“控件”。UI的运行时会非常细致地规定组件的一系列行为，包括：

-   组件的创建形式，你几乎很少能自己去写new Label()
-   组件的组合模式，一般正常点的都是树型，即组件拥有children和parent，除此之外基本没其它形态
-   组件的生命周期，从创建到销毁，什么时候更新、什么时候产生通知和回调，都是由运行时控制的

特别是时下更为流行的声明式UI开发，会将组件的细节更进一步地封装成某些标记语言，从而使得我们能实际接触并控制组件的行为的能力进一步收缩。

因为这一点，传统的设计模式几乎无法在UI上应用。除了composition这种UI自带的属性外，诸如 factory、decorator、proxy，都很少能应用在UI上。

**UI与最终视觉呈现强绑定，带着UI复用的可用性是非常低的。**

**因此，当一段逻辑脱离UI后，它会具备更好的被研究价值，能被更好地应用传统代码设计中的复用手段（如经典设计模式、继承、组合等），从而更高效率地发现复用点。**

所以，现在的主流框架会自带一个复用非视图逻辑的方案，Angular是Service，React是hooks，Vue 是 Composition

有渲染的无状态，有状态的无渲染”，它并不是单纯的对于dumb/container组件的区分，也不是基于某个框架的某个最佳实践的传道，**它本质是一种开发者远离难以抽象的部分的应对手段**

